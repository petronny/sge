<HTML>
<HEAD>
<TITLE>jsv.1</TITLE>
</HEAD>
<BODY>
<H1>jsv.1</H1>
<HR>
<PRE>
<!-- Manpage converted by man2html 3.0.1 -->

</PRE>
<H2>NAME</H2><PRE>
       JSV - Grid Engine Job Submission Verifier


</PRE>
<H2>DESCRIPTION</H2><PRE>
       JSV is an abbreviation for Job Submission Verifier. A JSV is a script
       or binary that can be used to verify, modify or reject a job during job
       submission.

       JSVs will be triggered by submit clients like <I>qsub</I>, <I>qrsh</I>, <I>qsh</I> and <I>qmon</I>
       on submit hosts (Client JSV), or they verify incoming jobs on the
       master host (Server JSV), or both.


</PRE>
<H2>CONFIGURATION</H2><PRE>
       JSVs can be configured in various locations. Either a <B>jsv_url</B> can be
       provided with the <B>-jsv</B> submit parameter during job submission, a
       corresponding switch can be added to one of the <B>sge_request</B> files, or a
       <B>jsv_url</B> can be configured in the global cluster configuration of the
       Grid Engine installation.

       All defined JSV instances will be executed in following order:

          1) qsub -jsv ...
          2) $cwd/.sge_request
          3) $HOME/.sge_request
          4) $SGE_ROOT/$SGE_CELL/common/sge_request
          5) Global configuration

       The Client JSVs (1-3) can be defined by Grid Engine end users, whereas
       the client JSV defined in the global sge_request file (4) and the
       server JSV (5) can only be defined by the Grid Engine administrators.

       Due to the fact that (4) and (5) are defined and configured by Grid
       Engine administrators and executed as the last JSV instances in the
       sequence of JSV scripts, an administrator has a way to enforce certain
       policies for a cluster.

       As soon as one JSV instance rejects a job the whole process of
       verification is stopped and the end user will get a corresponding error
       message that the submission of the job has failed.

       If a JSV accepts a job, or accepts a job after it applied several
       modifications, then the following JSV instance will get the job
       parameters including all modifications as input for the verification
       process.  This is done as long as either the job is accepted or
       rejected.

       Find more information on how to use Client JSVs in <B><A HREF="../htmlman1/qsub.html">qsub(1)</A></B>, and for
       Server JSVs in <B><A HREF="../htmlman5/sge_conf.html">sge_conf(5)</A></B>.


</PRE>
<H2>LIFETIME</H2><PRE>
       A Client or Server JSV is started as own UNIX process. This process
       communicates either with a Grid Engine client process or the master
       daemon by exchanging commands, job parameters, and other data via
       <B>stdin</B>/<B>stdout</B> channels.

       Client JSV instances are started by client applications before a job is
       sent to qmaster. This instance does the job verification for the job to
       be submitted. After that verification the JSV process is stopped.

       Server JSV instances are started for each worker thread part of the
       qmaster process.  (For version 6.2 of Grid Engine this means that two
       processes are started.)  Each of those processes has to verify job
       parameters for multiple jobs as long as the master is running, the
       underlying JSV configuration is not changed, and no error occurs.


</PRE>
<H2>TIMEOUT</H2><PRE>
       The timeout is a modifiable value that will measure the response time
       of either the client or server JSV. In the event that the response time
       of the JSV is longer than timeout value specified, this will result in
       the JSV being re-started. The server JSV timeout value is specified
       through the qmaster parameter <B>jsv_timeout</B>.  The client JSV timeout
       value is set through the environment variable <B>SGE_JSV_TIMEOUT</B>. The
       default value is 10 seconds, and this value must be greater than 0. If
       the timeout has been reached, the JSV will only try to re-start once,
       and if the timeout is reached again, an error will occur.


</PRE>
<H2>THRESHOLD</H2><PRE>
       The threshold value is defined as a qmaster parameter <B>jsv_threshold</B>.
       This value measures the time for a server job verification. If this
       time exceeds the defined threshold then additional logging will appear
       in the master message file at the INFO level. This value is specified
       in milliseconds and has a default value of 5000. If a value of 0 is
       defined then this means all jobs will be logged in the message file.


</PRE>
<H2>PROTOCOL</H2><PRE>
       After a JSV script or binary is started it will get commands through
       its <B>stdin</B> stream, and it has to respond with certain commands on the
       <B>stdout</B> stream. Data sent via the <B>stderr</B> stream of a JSV instance is
       ignored. Each command which is sent to/by a JSV script has to be
       terminated by a new line character ('<B>\n</B>'), whereas new line characters
       are not allowed in the whole command string itself.

       In general, commands which are exchanged between a JSV and
       client/qmaster have following format. Commands and arguments are case
       sensitive. Find the EBNF command description below.

             <B>command</B> := <B>command_name</B> ' ' { <B>argument</B> ' ' } ;

       A <B>command</B> starts with a <B>command_name</B> followed by a space character  and
       a space separated list of <B>arguments</B>.


</PRE>
<H2>PROTOCOL (JSV side)</H2><PRE>
       The following <B>commands</B> have to be implemented by a JSV script so that
       it conforms to version 1.0 of the JSV protocol, which was first
       implemented in Grid Engine 6.2u2:

       <B>begin_command</B> := '<B>BEGIN</B>' ;
              After a JSV instance has received all the <B>env_commands</B> and
              <B>param_commands</B> of a job which should be verified, the
              client/qmaster will trigger the verification process by sending
              one <B>begin_command</B>. After that it will wait for <B>param_commands</B>
              and <B>env_commands</B> which are sent back from the JSV instance to
              modify the job specification. As part of the verification
              process a JSV script or binary has to use the <B>result_command</B> to
              indicate that the verification process is finished for a job.

       <B>env_command</B> := <B>ENV</B> ' ' <B>modifier</B> ' ' <B>name</B> ' ' <B>value</B> ;

       <B>modifier</B> := '<B>ADD</B>' | '<B>MOD</B>' | '<B>DEL</B>' ;
              The <B>env_command</B> is an optional command which has only to be
              implemented by a JSV instance if the <B>send_data_command</B> is sent
              by this JSV before a <B>started_command</B> was sent. Only in that
              case, the client or master will use one or multiple <B>env_commands</B>
              to pass the environment variables (<B>name</B> and <B>value</B>) to the JSV
              instance to be exported to the job environment when the job is
              started. Client and qmaster will only send <B>env_commands</B> with the
              modifier '<B>ADD</B>'.

              JSV instances modify the set of environment variables by sending
              back <B>env_commands</B>, and by using the <B>modifiers</B> <B>ADD</B>, <B>MOD</B> and <B>DEL</B>.

       <B>param_command</B> := '<B>PARAM</B>' ' ' <B>param_parameter</B> ' ' <B>value</B> ;

       <B>param_parameter</B> := <B>submit_parameter</B> | <B>pseudo_parameter</B> ;
              The <B>param_command</B> has two additional arguments which are
              separated by space characters. The first argument is either a
              <B>submit_parameter</B> as specified in <B><A HREF="../htmlman1/qsub.html">qsub(1)</A></B>, or it is a
              <B>pseudo_parameters</B> as documented below.  The second parameter is
              the <B>value</B> of the corresponding <B>param_parameter</B>.

              Multiple <B>param_commands</B> will be sent to a JSV instance after the
              JSV has sent a <B>started_command</B>. The sum of all <B>param_commands</B>
              sent represents a job specification of the job which should be
              verified.

              <B>submit_parameters</B> are, for example, <B>b</B> (similar to the <B>qsub</B> <B>-b</B>
              switch), or <B>masterq</B> (similar to <B>qsub</B> <B>-masterq</B> switch). Find a
              complete list of <B>submit_parameters</B> in the <B><A HREF="../htmlman1/qsub.html">qsub(1)</A></B> man page.
              Please note that the <B>param_parameter</B> name and the corresponding
              <B>value</B> format is not equivalent to the qsub switch name and its
              argument format in all cases.  E.g. the <B>qsub</B> <B>-pe</B> parameters will
              by available as a set of parameters with the name <B>pe_name</B>,
              <B>pe_min</B>, <B>pe_max</B> and the switch combination <B>-soft</B> <B>-l</B> will be
              passed to JSV scripts as <B>l_soft</B> parameter. For details
              concerning this differences consult also the <B><A HREF="../htmlman1/qsub.html">qsub(1)</A></B> man page.

       <B>start_command</B> := '<B>START</B>' ;
              The <B>start_command</B> has no additional arguments. This command
              indicates that a new job verification should be started. It is
              the first command which will be sent to JSV script after it has
              been started and it will initiate each new job verification. A
              JSV instance might trash cached values which are still stored
              due to a previous job verification. The application which sends
              the <B>start_command</B> will wait for a <B>started_command</B> before it
              continues.

       <B>quit_command</B> := '<B>QUIT</B>' ;
              The <B>quit_command</B> has no additional arguments. If this command is
              sent to a JSV instance then it should terminate itself
              immediately.


</PRE>
<H2>PROTOCOL (client/qmaster side)</H2><PRE>
       A JSV script or binary can send a set of commands to a client/qmaster
       process to indicate its state in the communication process, to change
       the job specification of a job which should be verified, and to report
       messages or errors. Below you can find the commands which are
       understood by the client/qmaster which implements version 1.0 of the
       communication protocol introduced in Grid Engine 6.2u2:

       <B>error_command</B> := '<B>ERROR</B>' <B>message</B> ;
              Any time a JSV script encounters an error it might report it to
              the client/qmaster. If the error happens during a job
              verification the job which is currently verified will be
              rejected. The JSV binary or script will also be restarted before
              it gets a new verification task.

       <B>log_command</B> := '<B>LOG</B>' <B>log_level</B> ;

       <B>log_level</B> := '<B>INFO</B>' | '<B>WARNING</B>' | '<B>ERROR</B>'
              <B>log_commands</B> can be used whenever the client or qmaster expects
              input from a JSV instance. This command can be used in client
              JSVs to send information to the user submitting the job. In
              client JSVs all messages, independent of the <B>log_level</B>, will be
              printed to the <B>stdout</B> stream of the submit client. If a server
              JSV receives a <B>log_command</B> it will add the received message to
              the message file, respecting the specified <B>log_level</B>. Please
              note that <B>message</B> might contain spaces, but no new line
              characters.

       <B>param_command</B> (find definition above)
              By sending <B>param_commands</B>, a JSV script can change the job
              specification of the job which should be verified. If a JSV
              instance later on sends a <B>result_command</B> which indicates that a
              JSV instance should be accepted with corrections, then the
              values provided with these <B>param_commands</B> will be used to modify
              the job before it is accepted by the Grid Engine system.

       <B>result_command</B> := '<B>RESULT</B>' <B>result_type</B> [ <B>message</B> ] ;

       <B>result_type</B> := '<B>ACCEPT</B>' | '<B>CORRECT</B>' | '<B>REJECT</B>' | '<B>REJECT_WAIT</B>' ;
              After the verification of a job is done, a JSV script or binary
              has to send a <B>result_command</B> which indicates what should happen
              with the job.  If the <B>result_type</B> is <B>ACCEPTED</B> the job will be
              accepted as it was initially submitted by the end user. All
              <B>param_commands</B> and <B>env_commands</B> which might have been sent
              before the <B>result_command</B> are ignored in this case.  The
              <B>result_type</B> <B>CORRECT</B> indicates that the job should be accepted
              after all modifications sent via <B>param_commands</B> and <B>env_commands</B>
              are applied to the job.  <B>REJECT</B> and <B>REJECT_WAIT</B> cause the client
              or qmaster instance to reject the job.

       <B>send_data_command</B> := '<B>SEND</B>' <B>data_name</B> ;

       <B>data_name</B> := '<B>ENV</B>';
              If a client/qmaster receives a <B>send_env_command</B> from a JSV
              instance before a <B>started_command</B> is sent, then it will not only
              pass job parameters with <B>param_commands</B>, but also <B>env_commands</B>
              which provide the JSV with the information about which
              environment variables will be exported to the job environment if
              the job is accepted and started later on.

              The job environment is not passed to JSV instances by default
              because the job environment of the end user might contain data
              which might be interpreted wrongly in the JSV context, and might
              therefore cause errors or security issues.

       <B>started_command</B> := '<B>STARTED</B>' ;
              By sending the <B>started_command</B> a JSV instance indicates that it
              is ready to receive <B>param_commands</B> and <B>env_commands</B> for a new
              job verification. It will only receive <B>env_commands</B> if it sends
              a <B>send_data_command</B> before the <B>started_command</B>.


</PRE>
<H2>PSEUDO PARAMETERS</H2><PRE>
       <B>CLIENT</B> The corresponding value for the <B>CLIENT</B> parameter is either
              '<B>qmaster</B>' or the name of a submit client like '<B>qsub</B>', This
              parameter value can't be changed by JSV instances.  It will
              always be sent as part of a job verification.

       <B>CMDARGS</B>
              Number of arguments which will be passed to the job script or
              command  when the job execution is started.  It will always be
              sent as part of a job verification.  If no arguments should be
              passed to the job script or command it will have the value 0.
              This parameter can be changed by JSV instances. If the value of
              <B>CMDARGS</B> is bigger than the number of available <B>CMDARG</B><I>n</I>
              parameters, then the missing parameters will be automatically
              passed as empty parameters to the job script.

       <B>CMDARG</B><I>n</I>
              Individual command arguments, where <I>n</I> is an integer between 0
              and <B>CMDARGS</B>-1.

       <B>CMDNAME</B>
              Either the path to the script, the command name for binary
              submission, <B>STDIN</B> for standard input, or <B>NONE</B> in the case of an
              interactive job.  It will always be sent as part of a job
              verification.

       <B>CONTEXT</B>
              Either '<B>client</B>', if the JSV which receives this <B>param_command</B>
              was started by a command-line client like <I>qsub</I>, or <I>qsh</I>, or
              '<B>master</B>' if it was started by the <I>sge</I><B>_</B><I>qmaster</I> process.  It will
              always be sent as part of a job verification.  This parameter
              value can't be changed by JSV instances.

       <B>GROUP</B>  Defines the primary group of the user who tries to submit the
              job which should be verified. This parameter cannot be changed
              but is always sent as part of the verification process. The user
              name is passed as a parameter with the name <B>USER</B>.

       <B>JOB_ID</B> Not available in the client context (see <B>CONTEXT</B>). Otherwise it
              contains the job number of the job which will be submitted to
              Grid Engine when the verification process is successful. <B>JOB_ID</B>
              is an optional parameter which can't be changed by JSV
              instances.

       <B>USER</B>   User name of the user who tries to submit the job which should
              be verified. Cannot be changed but is always sent as part of the
              verification process. The group name is passed as a parameter
              with the name <B>GROUP</B>

       <B>VERSION</B>
              <B>VERSION</B> will always be sent as part of a job verification
              process and it will always be the first parameter which is sent.
              It will contain a version number of the format &lt;major&gt;.&lt;minor&gt;.
              In version 6.2u2 and higher the value will be '<B>1.0</B>', or higher
              if the protocol is changed in the future.  The value of this
              parameter can't be changed.


</PRE>
<H2>CAVEATS</H2><PRE>
       See <B><A HREF="../htmlman3/jsv_script_interface.html">jsv_script_interface(3)</A></B> for advice concerning shell script JSVs.


</PRE>
<H2>EXAMPLE</H2><PRE>
       Here is an example for the communication of a client with a JSV
       instance when the following job is submitted:

       &gt; qsub -pe p 3 -hard -l a=1,b=5 -soft -l q=all.q $SGE_ROOT/examples/jobs/sleeper.sh

       Data in the first column are sent from the client/qmaster to the JSV
       instance. Data contained in the second column are sent from the JSV
       script to the client/qmaster. Newline characters which terminate each
       line in the communication protocol are omitted.

          START
                                SEND ENV
                                STARTED
          PARAM VERSION 1.0
          PARAM CONTEXT client
          PARAM CLIENT qsub
          PARAM USER ernst
          PARAM GROUP staff
          PARAM CMDNAME /sge_root/examples/jobs/sleeper.sh
          PARAM CMDARGS 1
          PARAM CMDARG0 12
          PARAM l_hard a=1,b=5
          PARAM l_soft q=all.q
          PARAM M user@hostname
          PARAM N Sleeper
          PARAM o /dev/null
          PARAM pe_name pe1
          PARAM pe_min 3
          PARAM pe_max 3
          PARAM S /bin/sh
          BEGIN
                                RESULT STATE ACCEPT



</PRE>
<H2>SEE ALSO</H2><PRE>
       <B><A HREF="../htmlman1/sge_intro.html">sge_intro(1)</A></B>, <B><A HREF="../htmlman1/qalter.html">qalter(1)</A></B>, <B><A HREF="../htmlman1/qlogin.html">qlogin(1)</A></B>, <B><A HREF="../htmlman1/qmake.html">qmake(1)</A></B>, <B><A HREF="../htmlman1/qrsh.html">qrsh(1)</A></B>, <B><A HREF="../htmlman1/qsh.html">qsh(1)</A></B>, <B><A HREF="../htmlman1/qsub.html">qsub(1)</A></B>,
       <B><A HREF="../htmlman1/qtcsh.html">qtcsh(1)</A></B>, <B><A HREF="../htmlman3/jsv_script_interface.html">jsv_script_interface(3)</A></B>.


</PRE>
<H2>COPYRIGHT</H2><PRE>
       See <B><A HREF="../htmlman1/sge_intro.html">sge_intro(1)</A></B> for a full statement of rights and permissions.



SGE 8.0.0                $Date: 2009-08-25 19:39:34 $                   <B><A HREF="../htmlman1/JSV.html">JSV(1)</A></B>
</PRE>
<HR>
<ADDRESS>
Man(1) output converted with
<a href="http://www.oac.uci.edu/indiv/ehood/man2html.html">man2html</a>
</ADDRESS>
</BODY>
</HTML>
